<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ ARIA - Asistente Virtual IA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px; /* Contenedor m√°s ancho */
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 85vh; /* Altura a√∫n m√°s reducida */
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px; /* Padding reducido */
            text-align: center;
        }
        
        .header h1 {
            font-size: 2em; /* Tama√±o reducido */
            margin-bottom: 3px; /* Margen reducido */
        }
        
        .header p {
            opacity: 0.9;
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 15px; /* Padding reducido */
            overflow: hidden;
        }
        
        /* CHAT MESSAGES - √ÅREA DE CONVERSACI√ìN MUY COMPACTA */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 15px;
            margin-bottom: 10px;
            min-height: 200px;
            max-height: 300px;
            scrollbar-width: thin;
            scrollbar-color: #667eea #f8f9fa;
            display: flex;
            flex-direction: column;
            gap: 10px; /* Espacio muy reducido entre mensajes */
        }

        /* CONTENEDOR DE MENSAJE - ESPACIADO M√çNIMO */
        .message-container {
            width: 100%;
            display: flex;
            margin: 0 0 8px 0; /* Espaciado m√≠nimo */
            padding: 2px 0; /* Padding muy reducido */
            clear: both;
            min-height: 30px; /* Altura m√≠nima muy reducida */
        }
        
        /* Usuario - derecha */
        .message-container.user {
            justify-content: flex-end;
        }
        
        /* Asistente - izquierda */
        .message-container.assistant {
            justify-content: flex-start;
        }

        /* MENSAJE - ESPACIADO ULTRA COMPACTO */
        .message {
            padding: 10px 15px; /* Padding muy compacto */
            border-radius: 15px;
            max-width: 75%; /* Ancho aumentado */
            word-wrap: break-word;
            line-height: 1.4; /* Altura de l√≠nea reducida */
            position: relative;
            display: block;
            animation: slideIn 0.3s ease-out;
            margin: 2px 0; /* Margen muy reducido */
            min-height: 25px; /* Altura m√≠nima muy reducida */
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ESTILOS DE USUARIO */
        .user-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 8px;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
            text-align: left;
        }

        /* ESTILOS DE ASISTENTE */
        .assistant-message {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            text-align: left;
        }

        /* MENSAJE DE BIENVENIDA */
        .welcome-message {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);
        }.message-time {
            font-size: 0.75em;
            opacity: 0.6;
            margin-top: 8px;
            text-align: right;
        }
        
        .user-message .message-time {
            color: rgba(255, 255, 255, 0.8);
        }
        
        .assistant-message .message-time {
            color: #666;
        }
        
        .input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .input-group {
            flex: 1;
            display: flex;
            gap: 10px;
        }
        
        .text-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .text-input:focus {
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .feedback-buttons {
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid #f0f0f0;
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            clear: both;
        }
        
        /* Separador entre mensajes */
        .message-separator {
            clear: both;
            height: 10px;
            width: 100%;
            display: block;
        }
        
        /* Mejorar la visualizaci√≥n de mensajes */
        .chat-messages::after {
            content: "";
            display: table;
            clear: both;
        }
        
        .message::after {
            content: "";
            display: table;
            clear: both;
        }
        
        .feedback-buttons button {
            font-size: 12px;
            padding: 6px 12px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .feedback-buttons button:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .feedback-buttons span {
            font-size: 11px;
            color: #888;
            margin-right: 5px;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .voice-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .recording {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Clearfix para evitar solapamiento de elementos flotantes */
        .chat-messages::after {
            content: "";
            display: table;
            clear: both;
        }
        
        .message::after {
            content: "";
            display: table;
            clear: both;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px; /* Gap reducido */
            margin-top: 10px; /* Margen superior reducido */
        }
        
        .feature-card {
            background: white;
            padding: 10px; /* Padding reducido */
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .feature-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }
        
        .welcome-message {
            text-align: center;
            color: #666;
            font-style: italic;
            margin: 20px 0;
        }
        
        .typing {
            display: none;
            padding: 12px 18px;
            background: #f0f0f0;
            border-radius: 18px;
            margin-bottom: 15px;
            max-width: 80%;
        }
        
        .typing-dots {
            display: inline-block;
            animation: typing 1.5s infinite;
        }
        
        @keyframes typing {
            0%, 20% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ ARIA</h1>
            <p>Asistente de Reconocimiento e Inteligencia Artificial</p>
        </div>
        
        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <div class="welcome-message">
                    üëã ¬°Hola! Soy ARIA, tu asistente virtual. <br>
                    Puedes escribir o hablar conmigo. ¬°Preg√∫ntame lo que quieras!
                </div>
            </div>
            
            <div class="typing" id="typing">
                <span class="typing-dots">ARIA est√° escribiendo...</span>
            </div>
            
            <div class="input-container">
                <div class="input-group">
                    <input 
                        type="text" 
                        class="text-input" 
                        id="messageInput" 
                        placeholder="Escribe tu mensaje aqu√≠..."
                        onkeypress="handleKeyPress(event)"
                    >
                    <button class="btn btn-primary" onclick="sendMessage()">
                        üì§ Enviar
                    </button>
                </div>
            </div>
            
            <div class="voice-controls">
                <button class="btn btn-secondary" id="voiceBtn" onclick="toggleVoiceRecording()">
                    üé§ Hablar
                </button>
                <input type="file" id="audioFile" accept="audio/*" style="display: none;" onchange="uploadAudio()">
                <button class="btn btn-secondary" onclick="document.getElementById('audioFile').click()">
                    üìÅ Subir Audio
                </button>
                <button class="btn btn-secondary" onclick="mostrarEstadisticas()">
                    üìä Estad√≠sticas
                </button>
                <button class="btn btn-secondary" onclick="entrenarRedNeuronal()">
                    üß† Entrenar IA
                </button>
                <button class="btn btn-secondary" onclick="analizarTexto()">
                    üîç An√°lisis Neuronal
                </button>
                <button class="btn btn-secondary" onclick="buscarEnWeb()">
                    üåê B√∫squeda Web
                </button>
                <button class="btn btn-secondary" onclick="verConocimientoWeb()">
                    üìö Conocimiento Web
                </button>
                <button class="btn btn-secondary" onclick="nuevaSesion()">
                    üîÑ Nueva Sesi√≥n
                </button>
            </div>
            
            <div class="features">
                <div class="feature-card" onclick="sendQuickCommand('¬øQu√© hora es?')">
                    <div class="feature-icon">üïê</div>
                    <div>Hora actual</div>
                </div>
                <div class="feature-card" onclick="sendQuickCommand('¬øQu√© d√≠a es hoy?')">
                    <div class="feature-icon">üìÖ</div>
                    <div>Fecha de hoy</div>
                </div>
                <div class="feature-card" onclick="sendQuickCommand('Cu√©ntame un chiste')">
                    <div class="feature-icon">üòÑ</div>
                    <div>Chiste</div>
                </div>
                <div class="feature-card" onclick="sendQuickCommand('¬øC√≥mo est√°s?')">
                    <div class="feature-icon">üí¨</div>
                    <div>Conversar</div>
                </div>
                <div class="feature-card" onclick="sendQuickCommand('estadisticas')">
                    <div class="feature-icon">üß†</div>
                    <div>Mi Aprendizaje</div>
                </div>
                <div class="feature-card" onclick="sendQuickCommand('buscar noticias sobre inteligencia artificial')">
                    <div class="feature-icon">üåê</div>
                    <div>Buscar en Web</div>
                </div>
                <div class="feature-card" onclick="sendQuickCommand('qu√© es machine learning')">
                    <div class="feature-icon">üîç</div>
                    <div>Informaci√≥n Actual</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isRecording = false;
        let mediaRecorder;
        let audioChunks = [];
        
        function addMessage(content, isUser = false, addFeedback = false, originalQuestion = '') {
            const messagesContainer = document.getElementById('chatMessages');
            
            // CREAR CONTENEDOR ANTI-SOLAPAMIENTO CON ESPACIADO ULTRA COMPACTO
            const containerDiv = document.createElement('div');
            containerDiv.className = `message-container ${isUser ? 'user' : 'assistant'}`;
            containerDiv.style.cssText = `
                width: 100%;
                display: flex;
                margin: 0 0 8px 0; /* Margen m√≠nimo */
                padding: 2px 0; /* Padding ultra compacto */
                clear: both;
                min-height: 30px; /* Altura m√≠nima muy reducida */
                ${isUser ? 'justify-content: flex-end;' : 'justify-content: flex-start;'}
            `;
            
            // CREAR MENSAJE CON ESPACIADO ULTRA COMPACTO
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'assistant-message'}`;
            messageDiv.style.cssText = `
                max-width: 75%; /* Ancho aumentado */
                display: block;
                position: relative;
                margin: 2px 0; /* Margen m√≠nimo */
                padding: 10px 15px; /* Padding ultra compacto */
                line-height: 1.4; /* Espaciado de l√≠nea reducido */
            `;
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            
            let feedbackButtons = '';
            if (addFeedback && !isUser) {
                const messageId = Date.now();
                feedbackButtons = `
                    <div class="feedback-buttons">
                        <span>¬øFue √∫til?</span>
                        <button onclick="darFeedback('${originalQuestion}', '${content.replace(/'/g, "\\'")}', 5, ${messageId})">
                            üëç S√≠
                        </button>
                        <button onclick="darFeedback('${originalQuestion}', '${content.replace(/'/g, "\\'")}', 2, ${messageId})">
                            üëé No
                        </button>
                        <button onclick="mostrarEstadisticas()">
                            üìä Stats
                        </button>
                    </div>
                `;
            }
            
            messageDiv.innerHTML = `
                <div>${content}</div>
                <div class="message-time">${timeStr}</div>
                ${feedbackButtons}
            `;
            
            // Agregar mensaje al contenedor
            containerDiv.appendChild(messageDiv);
            messagesContainer.appendChild(containerDiv);
            
            // Scroll suave al final
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 100);
        }
        
        function showTyping() {
            document.getElementById('typing').style.display = 'block';
        }
        
        function hideTyping() {
            document.getElementById('typing').style.display = 'none';
        }
        
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Mostrar mensaje del usuario
            addMessage(message, true);
            input.value = '';
            
            // Mostrar indicador de escritura
            showTyping();
            
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ mensaje: message })
                });
                
                const data = await response.json();
                
                setTimeout(() => {
                    hideTyping();
                    if (data.respuesta) {
                        addMessage(data.respuesta, false, true, message);  // Agregar feedback a respuestas
                    } else if (data.error) {
                        addMessage(`Error: ${data.error}`);
                    } else {
                        addMessage('Lo siento, hubo un error procesando tu mensaje.');
                    }
                }, 1000);
                
            } catch (error) {
                hideTyping();
                addMessage('Error de conexi√≥n. Intenta de nuevo.');
                console.error('Error:', error);
            }
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        function sendQuickCommand(command) {
            document.getElementById('messageInput').value = command;
            sendMessage();
        }
        
        async function toggleVoiceRecording() {
            const voiceBtn = document.getElementById('voiceBtn');
            
            if (!isRecording) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    
                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };
                    
                    mediaRecorder.onstop = async () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        await processVoiceAudio(audioBlob);
                    };
                    
                    mediaRecorder.start();
                    isRecording = true;
                    voiceBtn.innerHTML = '‚èπÔ∏è Parar';
                    voiceBtn.classList.add('recording');
                    
                } catch (error) {
                    alert('Error accediendo al micr√≥fono: ' + error.message);
                }
            } else {
                mediaRecorder.stop();
                isRecording = false;
                voiceBtn.innerHTML = 'üé§ Hablar';
                voiceBtn.classList.remove('recording');
                
                // Detener todas las pistas del stream
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
            }
        }
        
        async function processVoiceAudio(audioBlob) {
            showTyping();
            
            const formData = new FormData();
            formData.append('audio', audioBlob, 'voice.wav');
            
            try {
                const response = await fetch('/transcribir_audio', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                hideTyping();
                
                if (data.success) {
                    addMessage(`üé§ "${data.transcripcion}"`, true);
                    addMessage(data.respuesta);
                } else {
                    addMessage('Error procesando el audio de voz.');
                }
                
            } catch (error) {
                hideTyping();
                addMessage('Error enviando audio de voz.');
                console.error('Error:', error);
            }
        }
        
        async function uploadAudio() {
            const fileInput = document.getElementById('audioFile');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            showTyping();
            addMessage(`üìÅ Procesando archivo: ${file.name}`, true);
            
            const formData = new FormData();
            formData.append('audio', file);
            
            try {
                const response = await fetch('/transcribir_audio', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                hideTyping();
                
                if (data.success) {
                    addMessage(`üìù Transcripci√≥n: "${data.transcripcion}"`);
                    addMessage(data.respuesta);
                } else {
                    addMessage('Error procesando el archivo de audio.');
                }
                
            } catch (error) {
                hideTyping();
                addMessage('Error enviando el archivo.');
                console.error('Error:', error);
            }
            
            fileInput.value = '';
        }
        
        // üß† SISTEMA DE RETROALIMENTACI√ìN Y APRENDIZAJE
        async function darFeedback(pregunta, respuesta, calificacion, messageId) {
            try {
                const response = await fetch('/feedback', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        pregunta: pregunta,
                        respuesta: respuesta,
                        calificacion: calificacion
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Ocultar botones de feedback despu√©s de calificar
                    const feedbackDiv = document.querySelector(`[onclick*="${messageId}"]`).parentElement;
                    feedbackDiv.innerHTML = `
                        <span style="color: #4CAF50; font-size: 12px;">
                            ‚úÖ ¬°Gracias por tu feedback! Esto me ayuda a mejorar üß†
                        </span>
                    `;
                } else {
                    addMessage('Error guardando feedback.');
                }
            } catch (error) {
                addMessage('Error de conexi√≥n al guardar feedback.');
                console.error('Error:', error);
            }
        }
        
        async function mostrarEstadisticas() {
            try {
                const response = await fetch('/estadisticas');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.estadisticas;
                    const mensaje = `
üìä **Estad√≠sticas de Aprendizaje ARIA**

üî¢ **Conversaciones:** ${stats.total_conversaciones}
üëç **Feedback positivo:** ${stats.feedback_positivo}
üëé **Feedback negativo:** ${stats.feedback_negativo}
üìà **Satisfacci√≥n:** ${(stats.ratio_satisfaccion * 100).toFixed(1)}%
üß† **Respuestas aprendidas:** ${stats.respuestas_aprendidas}

üî• **Top preguntas:**
${stats.top_preguntas.map(([q, c]) => `‚Ä¢ ${q}: ${c} veces`).join('\n').substring(0, 200)}...
                    `;
                    addMessage(mensaje);
                } else {
                    addMessage('Error obteniendo estad√≠sticas.');
                }
            } catch (error) {
                addMessage('Error de conexi√≥n al obtener estad√≠sticas.');
                console.error('Error:', error);
            }
        }
        
        async function nuevaSesion() {
            try {
                const response = await fetch('/nueva_sesion', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    addMessage(data.mensaje);
                    // Limpiar el chat opcionalmente
                    // document.getElementById('chatMessages').innerHTML = '';
                } else {
                    addMessage('Error iniciando nueva sesi√≥n.');
                }
            } catch (error) {
                addMessage('Error de conexi√≥n.');
                console.error('Error:', error);
            }
        }
        
        // üß† FUNCIONES DE RED NEURONAL
        async function entrenarRedNeuronal() {
            try {
                addMessage('üß† Iniciando entrenamiento de red neuronal... Esto puede tomar unos momentos.');
                
                const response = await fetch('/entrenar_red_neuronal', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    let mensaje = data.mensaje;
                    if (data.metricas) {
                        mensaje += `\n\nüìä **M√©tricas del entrenamiento:**
                        ‚Ä¢ √âpocas: ${data.metricas.epochs}
                        ‚Ä¢ Exactitud final: ${(data.metricas.accuracy_final * 100).toFixed(1)}%
                        ‚Ä¢ P√©rdida final: ${data.metricas.loss_final.toFixed(3)}`;
                    }
                    addMessage(mensaje);
                } else {
                    addMessage(`‚ùå ${data.mensaje}`);
                }
            } catch (error) {
                addMessage('Error entrenando red neuronal.');
                console.error('Error:', error);
            }
        }
        
        async function analizarTexto() {
            try {
                const texto = prompt('üîç Ingresa el texto que quieres analizar con la red neuronal:');
                if (!texto) return;
                
                addMessage(`üîç Analizando: "${texto}"`);
                
                const response = await fetch('/analisis_neuronal', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ texto: texto })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const mensaje = `üß† **An√°lisis Neuronal:**
                    
üìã **Texto:** "${texto}"
üè∑Ô∏è **Categor√≠a detectada:** ${data.categoria}
üìä **Confianza:** ${data.confianza}
ü§ñ **Respuesta sugerida:** ${data.respuesta_sugerida}`;
                    
                    addMessage(mensaje);
                } else {
                    addMessage(`‚ùå ${data.mensaje}`);
                }
            } catch (error) {
                addMessage('Error en an√°lisis neuronal.');
                console.error('Error:', error);
            }
        }
        
        async function buscarEnWeb() {
            try {
                const consulta = prompt('üåê ¬øQu√© informaci√≥n quieres buscar en la web?');
                if (!consulta) return;
                
                addMessage(`üåê Buscando en web: "${consulta}"`);
                addMessage("üîç Buscando informaci√≥n actualizada... Esto puede tomar unos momentos.");
                
                const response = await fetch('/buscar_web', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        consulta: consulta,
                        profundidad: 3
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const mensaje = `üåê **Informaci√≥n encontrada en web:**
                    
üîç **Consulta:** "${data.consulta}"
üìä **Resultados encontrados:** ${data.resultados}
üìö **Fuentes procesadas:** ${data.contenido_procesado}

üìñ **Resumen:**
${data.resumen}

üí° *Esta informaci√≥n ha sido agregada a mi conocimiento para futuras consultas.*`;
                    
                    addMessage(mensaje, false, true, consulta);
                } else {
                    addMessage(`‚ùå Error en b√∫squeda web: ${data.error || 'Error desconocido'}`);
                }
            } catch (error) {
                addMessage('‚ùå Error al buscar en web. Verifica tu conexi√≥n a internet.');
                console.error('Error:', error);
            }
        }
        
        async function verConocimientoWeb() {
            try {
                addMessage("üìö Consultando mi conocimiento web...");
                
                const response = await fetch('/conocimiento_web', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.estadisticas;
                    const reciente = data.conocimiento_reciente;
                    
                    let conocimientoRecienteTexto = "";
                    if (reciente.length > 0) {
                        conocimientoRecienteTexto = "\n\nüïê **Conocimiento reciente:**\n" + 
                            reciente.map((item, index) => 
                                `${index + 1}. ${item.titulo} (${item.url.split('/')[2]})`
                            ).join('\n');
                    }
                    
                    const mensaje = `üìö **Mi Conocimiento Web:**
                    
üìä **Total de conocimiento:** ${stats.total_conocimiento} elementos
üïê **Aprendido en 24h:** ${stats.ultimas_24h} elementos
üåê **Dominios √∫nicos:** ${stats.dominios_unicos}
‚≠ê **Confiabilidad promedio:** ${(stats.promedio_confiabilidad * 100).toFixed(1)}%
${conocimientoRecienteTexto}

üí° *Usa palabras clave como "buscar", "qu√© es", "noticias" para activar b√∫squedas web autom√°ticas.*`;
                    
                    addMessage(mensaje);
                } else {
                    addMessage(`‚ùå Error obteniendo conocimiento web: ${data.error || 'Error desconocido'}`);
                }
            } catch (error) {
                addMessage('‚ùå Error al consultar conocimiento web.');
                console.error('Error:', error);
            }
        }
        
        // Mensaje de bienvenida inicial
        setTimeout(() => {
            addMessage("üß† ¬°Hola! Soy ARIA, tu asistente con RED NEURONAL AVANZADA y acceso a informaci√≥n web en tiempo real. Uso TensorFlow, Deep Learning y b√∫squeda web inteligente para darte las mejores respuestas. ¬°Prueba pregunt√°ndome sobre noticias actuales o cualquier tema!", false, true, "bienvenida");
        }, 1500);
    </script>
</body>
</html>